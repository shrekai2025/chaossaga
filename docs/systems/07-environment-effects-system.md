# ChaosSaga - ç¯å¢ƒæ•ˆæœæœºåˆ¶è¯¦ç»†è®¾è®¡

> ç‰ˆæœ¬: 1.0 | æ›´æ–°æ—¥æœŸ: 2026-02-08
> å¯¹åº” GDD ç« èŠ‚: å…«ã€åŒºåŸŸä¸å…³å¡ç³»ç»Ÿ

---

## ä¸€ã€ç¯å¢ƒå››è¦ç´ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¯å¢ƒå½±å“æˆ˜æ–—çš„å››è¦ç´                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  å¤©æ°” â”€â”€â”                                                       â”‚
â”‚  æ—¶é—´ â”€â”€â”¤â”€â”€ å åŠ è®¡ç®— â”€â”€â†’ æœ€ç»ˆç¯å¢ƒæ•ˆæœ â”€â”€â†’ åº”ç”¨åˆ°æˆ˜æ–—             â”‚
â”‚  å­£èŠ‚ â”€â”€â”¤                                                       â”‚
â”‚  åœ°å½¢ â”€â”€â”˜                                                       â”‚
â”‚                                                                 â”‚
â”‚  å½±å“èŒƒå›´ï¼šå±æ€§åŠ æˆ/å‡å°‘ã€æŠ€èƒ½æ•ˆæœã€è§¦å‘æ¦‚ç‡ã€æ‰è½ç‡             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€å¤©æ°”æ•ˆæœè¡¨

| å¤©æ°” | å±æ€§å½±å“ | æŠ€èƒ½å½±å“ | ç‰¹æ®Šæ•ˆæœ | å‡ºç°æ¦‚ç‡ |
|------|----------|----------|----------|----------|
| æ™´ | æ—  | å…‰ç³»+10% | æ—  | 35% |
| å¤šäº‘ | æ—  | æ—  | æ—  | 20% |
| é›¨ | é€Ÿåº¦-5% | æ°´ç³»+15%ï¼Œç«ç³»-15% | å¥‡é‡æ¦‚ç‡+5% | 15% |
| å¤§é›¨ | é€Ÿåº¦-10% | æ°´ç³»+25%ï¼Œç«ç³»-25% | é›·ç³»æŠ€èƒ½æœ‰5%æ¦‚ç‡è¿é” | 8% |
| é›·æš´ | é€Ÿåº¦-15% | æ°´ç³»+20%ï¼Œé£ç³»+20%ï¼Œç«ç³»-30% | æ¯å›åˆ5%æ¦‚ç‡éšæœºé›·å‡»(å…¨ä½“) | 5% |
| é›ª | é€Ÿåº¦-10% | æ°´ç³»+10%ï¼Œå†°ç³»æ•ˆæœ+1å›åˆ | å†°å†»æ¦‚ç‡+10% | 7% |
| å¤§é›ª | é€Ÿåº¦-20% | æ°´ç³»+20%ï¼Œç«ç³»-20% | æ¯3å›åˆå†°å†»åˆ¤å®š(å…¨ä½“) | 3% |
| è¿·é›¾ | å‘½ä¸­ç‡-10% | æš—ç³»+15% | å¥‡é‡æ¦‚ç‡+30%ï¼Œé€ƒè·‘æˆåŠŸç‡+20% | 5% |
| çƒˆæ—¥ | æ—  | ç«ç³»+20%ï¼Œæ°´ç³»-10% | æ¯5å›åˆç¼çƒ­(æ‰£2%HP) | 2% |

### 2.1 å¤©æ°”æ•ˆæœæ•°æ®ç»“æ„

```typescript
// lib/game/environment-effects.ts

interface WeatherEffect {
  id: string;
  name: string;
  statModifiers: {
    speed?: number;          // ç™¾åˆ†æ¯”ä¿®æ­£ï¼Œå¦‚ -0.05 = -5%
    accuracy?: number;       // å‘½ä¸­ç‡ä¿®æ­£
  };
  elementModifiers: Record<string, number>;  // å±æ€§ä¼¤å®³ä¿®æ­£
  statusModifiers: {
    effectType?: string;     // å—å½±å“çš„çŠ¶æ€æ•ˆæœ
    durationBonus?: number;  // æŒç»­æ—¶é—´åŠ æˆ
    chanceBonus?: number;    // è§¦å‘æ¦‚ç‡åŠ æˆ
  }[];
  specialEffects: SpecialEnvironmentEffect[];
  adventureChanceBonus: number;
  weight: number;            // å‡ºç°æƒé‡
}

interface SpecialEnvironmentEffect {
  trigger: 'round_start' | 'round_end' | 'round_interval';
  interval?: number;         // round_interval æ—¶çš„é—´éš”
  effect: string;            // æ•ˆæœç±»å‹
  target: 'all' | 'random_one' | 'all_enemies' | 'all_players';
  value: number;             // æ•ˆæœæ•°å€¼
  chance: number;            // è§¦å‘æ¦‚ç‡
  description: string;
}

const WEATHER_EFFECTS: Record<string, WeatherEffect> = {
  'æ™´': {
    id: 'sunny', name: 'æ™´',
    statModifiers: {},
    elementModifiers: { light: 0.1 },
    statusModifiers: [],
    specialEffects: [],
    adventureChanceBonus: 0,
    weight: 35,
  },
  'é›¨': {
    id: 'rain', name: 'é›¨',
    statModifiers: { speed: -0.05 },
    elementModifiers: { water: 0.15, fire: -0.15 },
    statusModifiers: [],
    specialEffects: [],
    adventureChanceBonus: 0.05,
    weight: 15,
  },
  'é›·æš´': {
    id: 'thunderstorm', name: 'é›·æš´',
    statModifiers: { speed: -0.15 },
    elementModifiers: { water: 0.2, wind: 0.2, fire: -0.3 },
    statusModifiers: [],
    specialEffects: [{
      trigger: 'round_end',
      effect: 'lightning_strike',
      target: 'random_one',
      value: 0.05, // 5% æœ€å¤§HP
      chance: 0.05,
      description: 'é›·ç”µéšæœºåŠˆä¸‹ï¼',
    }],
    adventureChanceBonus: 0.2,
    weight: 5,
  },
  'è¿·é›¾': {
    id: 'fog', name: 'è¿·é›¾',
    statModifiers: { accuracy: -0.1 },
    elementModifiers: { dark: 0.15 },
    statusModifiers: [],
    specialEffects: [],
    adventureChanceBonus: 0.3,
    weight: 5,
  },
};
```

---

## ä¸‰ã€æ—¶é—´æ•ˆæœè¡¨

| æ—¶é—´ | å±æ€§å½±å“ | æŠ€èƒ½å½±å“ | ç‰¹æ®Šæ•ˆæœ |
|------|----------|----------|----------|
| é»æ˜ (5:00-7:00) | å…‰ç³»+15% | æš—ç³»-10% | å¥‡é‡æ¦‚ç‡+20% |
| æ—©æ™¨ (7:00-11:00) | æ—  | æ—  | ç»éªŒè·å–+5% |
| ä¸­åˆ (11:00-14:00) | ç«ç³»+10% | MPæ¶ˆè€—+5% | ç«ç³»æ•Œäººæ´»è·ƒåº¦+10% |
| ä¸‹åˆ (14:00-17:00) | æ—  | æ—  | æ—  |
| å‚æ™š (17:00-19:00) | æš—ç³»+5%ï¼Œå…‰ç³»+5% | æ—  | å¥‡é‡æ¦‚ç‡+10% |
| å¤œæ™š (19:00-23:00) | æš—ç³»+15%ï¼Œå…‰ç³»-10% | é€Ÿåº¦+5% | æš—ç³»æ•Œäººå‡ºç°ç‡+20% |
| æ·±å¤œ (23:00-5:00) | æš—ç³»+25%ï¼Œå…‰ç³»-20% | é€Ÿåº¦+10% | å¥‡é‡æ¦‚ç‡+25%ï¼Œç‰¹æ®Šæ•Œäººå‡ºç° |

---

## å››ã€å­£èŠ‚æ•ˆæœè¡¨

| å­£èŠ‚ | æŒç»­æ•ˆæœ | æŠ€èƒ½å½±å“ | èµ„æºå½±å“ | ç‰¹æ®Šäº‹ä»¶ |
|------|----------|----------|----------|----------|
| æ˜¥ | HPè‡ªç„¶æ¢å¤+10% | é£ç³»+10%ï¼ŒåœŸç³»+10% | è‰è¯æ‰è½+20% | ç²¾çµæ´»è·ƒ |
| å¤ | ç«ç³»æ•Œäºº+20%å‡ºç°ç‡ | ç«ç³»+15%ï¼Œæ°´ç³»+10% | çŸ¿çŸ³æ‰è½+15% | æµ·æ€ªæ½®æ± |
| ç§‹ | é‡‘å¸è·å–+10% | æš—ç³»+10% | è£…å¤‡æ‰è½+10% | å•†äººå¢å¤š |
| å†¬ | é€Ÿåº¦-5% | æ°´ç³»+15%ï¼Œç«ç³»-10% | è¯å‰‚æ¶ˆè€—+20% | æš´é£é›ª |

---

## äº”ã€åœ°å½¢æ•ˆæœè¡¨

| åœ°å½¢ | å±æ€§å½±å“ | æŠ€èƒ½å½±å“ | ç‰¹æ®Šæ•ˆæœ |
|------|----------|----------|----------|
| æµ·å²¸/æµ…æµ· | æ—  | æ°´ç³»+20% | æµ·æ´‹ä¹‹å­MPæ¢å¤+10%/å›åˆ |
| æ·±æµ· | é€Ÿåº¦-10%ï¼Œéæ°´ç³»-10% | æ°´ç³»+30% | éæ°´ç³»å‘¼å¸åˆ¤å®š(-2%HP/å›åˆ) |
| æ£®æ— | æ—  | é£ç³»+15%ï¼Œç«ç³»+10% | é€ƒè·‘æˆåŠŸç‡+15% |
| å±±åœ° | é˜²å¾¡+10% | åœŸç³»+20% | è½çŸ³äº‹ä»¶(5%/å›åˆ) |
| åŸé•‡ | HP/MPæ¢å¤+20% | æ—  | æ— æˆ˜æ–—(å®‰å…¨åŒº) |
| æ²™æ¼  | é€Ÿåº¦-5%ï¼ŒMPæ¶ˆè€—+10% | ç«ç³»+20%ï¼ŒåœŸç³»+15% | æ¯3å›åˆç¼çƒ­(-3%HP) |
| ç§˜å¢ƒ | å…¨å±æ€§+5% | æ—  | æ‰è½å“è´¨æå‡ä¸€çº§ |

---

## å…­ã€ç¯å¢ƒæ•ˆæœåˆæˆè®¡ç®—

```typescript
/**
 * åˆæˆæ‰€æœ‰ç¯å¢ƒæ•ˆæœä¸ºæœ€ç»ˆæˆ˜æ–—ä¿®æ­£
 */
interface CombinedEnvironmentEffect {
  statModifiers: {
    speedPercent: number;
    accuracyPercent: number;
    hpRegenPercent: number;
    mpRegenPercent: number;
    defensePercent: number;
  };
  elementDamageModifiers: Record<string, number>;
  specialEffects: SpecialEnvironmentEffect[];
  expMultiplier: number;
  goldMultiplier: number;
  lootQualityBonus: number;
  adventureChanceBonus: number;
}

function calculateCombinedEnvironment(
  weather: string,
  timeOfDay: string,
  season: string,
  terrain: string
): CombinedEnvironmentEffect {
  const result: CombinedEnvironmentEffect = {
    statModifiers: { speedPercent: 0, accuracyPercent: 0, hpRegenPercent: 0, mpRegenPercent: 0, defensePercent: 0 },
    elementDamageModifiers: {},
    specialEffects: [],
    expMultiplier: 1.0,
    goldMultiplier: 1.0,
    lootQualityBonus: 0,
    adventureChanceBonus: 0,
  };

  // å åŠ å¤©æ°”æ•ˆæœ
  const w = WEATHER_EFFECTS[weather];
  if (w) {
    applyModifiers(result, w);
  }

  // å åŠ æ—¶é—´æ•ˆæœ
  const t = TIME_EFFECTS[timeOfDay];
  if (t) {
    applyModifiers(result, t);
  }

  // å åŠ å­£èŠ‚æ•ˆæœ
  const s = SEASON_EFFECTS[season];
  if (s) {
    applyModifiers(result, s);
  }

  // å åŠ åœ°å½¢æ•ˆæœ
  const te = TERRAIN_EFFECTS[terrain];
  if (te) {
    applyModifiers(result, te);
  }

  return result;
}

/**
 * åº”ç”¨ç¯å¢ƒæ•ˆæœåˆ°ä¼¤å®³è®¡ç®—
 */
function getEnvironmentDamageBonus(
  skillElement: string,
  environment: CombinedEnvironmentEffect
): number {
  return 1.0 + (environment.elementDamageModifiers[skillElement] ?? 0);
}
```

---

## ä¸ƒã€å¤©æ°”ä¸æ—¶é—´æ¨ç§»

```typescript
/**
 * å¤©æ°”éšæœºå˜åŒ–ï¼ˆæ¯æ¬¡æ¢ç´¢/æˆ˜æ–—åæœ‰æ¦‚ç‡å˜åŒ–ï¼‰
 */
function tickWeather(currentWeather: string): string {
  // 30%æ¦‚ç‡å¤©æ°”å˜åŒ–
  if (Math.random() > 0.3) return currentWeather;

  // å¤©æ°”å€¾å‘äºæ¸å˜ï¼ˆæ™´â†’å¤šäº‘â†’é›¨ï¼Œè€Œéæ™´â†’é›·æš´ï¼‰
  const transitions: Record<string, Record<string, number>> = {
    'æ™´':   { 'æ™´': 40, 'å¤šäº‘': 40, 'çƒˆæ—¥': 10, 'è¿·é›¾': 10 },
    'å¤šäº‘': { 'å¤šäº‘': 30, 'æ™´': 30, 'é›¨': 25, 'è¿·é›¾': 15 },
    'é›¨':   { 'é›¨': 30, 'å¤§é›¨': 25, 'å¤šäº‘': 30, 'é›·æš´': 15 },
    'å¤§é›¨': { 'å¤§é›¨': 25, 'é›¨': 30, 'é›·æš´': 30, 'å¤šäº‘': 15 },
    'é›·æš´': { 'é›·æš´': 20, 'å¤§é›¨': 40, 'é›¨': 30, 'å¤šäº‘': 10 },
    'é›ª':   { 'é›ª': 35, 'å¤§é›ª': 25, 'å¤šäº‘': 25, 'æ™´': 15 },
    'å¤§é›ª': { 'å¤§é›ª': 25, 'é›ª': 40, 'å¤šäº‘': 25, 'è¿·é›¾': 10 },
    'è¿·é›¾': { 'è¿·é›¾': 30, 'å¤šäº‘': 30, 'æ™´': 25, 'é›¨': 15 },
    'çƒˆæ—¥': { 'çƒˆæ—¥': 25, 'æ™´': 50, 'å¤šäº‘': 25 },
  };

  const options = transitions[currentWeather] ?? { 'æ™´': 100 };
  return weightedRandomSelect(Object.entries(options).map(([w, weight]) => ({ value: w, weight })));
}

/**
 * æ—¶é—´æ¨ç§»ï¼ˆæ¯åœºæˆ˜æ–—æ¨è¿›çº¦30åˆ†é’Ÿæ¸¸æˆæ—¶é—´ï¼‰
 */
const TIME_PROGRESSION = ['é»æ˜', 'æ—©æ™¨', 'æ—©æ™¨', 'ä¸­åˆ', 'ä¸‹åˆ', 'ä¸‹åˆ', 'å‚æ™š', 'å¤œæ™š', 'å¤œæ™š', 'æ·±å¤œ', 'æ·±å¤œ', 'é»æ˜'];

function advanceTime(currentTime: string, battles: number = 1): string {
  const currentIdx = TIME_PROGRESSION.indexOf(currentTime);
  const newIdx = (currentIdx + battles) % TIME_PROGRESSION.length;
  return TIME_PROGRESSION[newIdx];
}
```

---

> ğŸ“ æœ¬æ–‡æ¡£å®šä¹‰äº† ChaosSaga çš„å®Œæ•´ç¯å¢ƒæ•ˆæœç³»ç»Ÿã€‚å¤©æ°”/æ—¶é—´/å­£èŠ‚/åœ°å½¢å››è¦ç´ å åŠ è®¡ç®—ï¼Œå½±å“å±æ€§ã€æŠ€èƒ½ä¼¤å®³ã€ç‰¹æ®Šæ•ˆæœå’Œå¥–åŠ±ã€‚å¤©æ°”æ”¯æŒè‡ªç„¶æ¸å˜ï¼Œæ—¶é—´éšæˆ˜æ–—æ¨è¿›ã€‚æ‰€æœ‰è®¡ç®—çº¯æ•°å€¼é©±åŠ¨ã€‚
