# ChaosSaga - éš¾åº¦æ›²çº¿ä¸æ•°å€¼å¹³è¡¡è¯¦ç»†è®¾è®¡

> ç‰ˆæœ¬: 1.0 | æ›´æ–°æ—¥æœŸ: 2026-02-08
> å¯¹åº” GDD ç« èŠ‚: ä¸‰ã€ç©å®¶ç³»ç»Ÿ / å››ã€æˆ˜æ–—ç³»ç»Ÿ
> è®¾è®¡åŸåˆ™: **å…¨éƒ¨ä¼ ç»Ÿæ•°å€¼è®¡ç®—ï¼Œæ•°å­¦å…¬å¼é©±åŠ¨**

---

## ä¸€ã€è®¾è®¡ç›®æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°å€¼å¹³è¡¡è®¾è®¡ç›®æ ‡                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. æˆé•¿æ„Ÿï¼šç©å®¶æ¯æ¬¡æå‡éƒ½èƒ½æ„Ÿå—åˆ°æ˜æ˜¾çš„å˜å¼º                       â”‚
â”‚  2. æŒ‘æˆ˜æ„Ÿï¼šåŒç­‰çº§å†…å®¹ä¿æŒ 60-70% èƒœç‡ï¼Œä¸æ— èŠä¹Ÿä¸æ²®ä¸§            â”‚
â”‚  3. ç­–ç•¥æ€§ï¼šå±æ€§å…‹åˆ¶å’ŒæŠ€èƒ½é€‰æ‹©æ¯”çº¯ç­‰çº§ç¢¾å‹æ›´é‡è¦                   â”‚
â”‚  4. å¯æŒç»­ï¼šç»æµäº§å‡º/æ¶ˆè€—é•¿æœŸå¹³è¡¡ï¼Œä¸é€šèƒ€ä¹Ÿä¸ç´§ç¼©                 â”‚
â”‚  5. èŠ‚å¥æ„Ÿï¼šæ¯ä¸ªæ¸¸æˆä¼šè¯(20-30åˆ†é’Ÿ)éƒ½æœ‰"å®Œæˆä¸€ä»¶äº‹"çš„æ»¡è¶³æ„Ÿ       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€ç©å®¶æˆé•¿æ›²çº¿

### 2.1 ç­‰çº§ä¸å±æ€§å®Œæ•´å¯¹ç…§è¡¨ï¼ˆæµ·æ´‹çº§ Lv.1-10 è¯¦è¡¨ï¼‰

```
å¢ƒç•Œç³»æ•° = 1.0 (æµ·æ´‹çº§)
```

| Lv | æœ€å¤§HP | æœ€å¤§MP | æ”»å‡» | é˜²å¾¡ | é€Ÿåº¦ | å‡çº§æ‰€éœ€ç»éªŒ | ç´¯è®¡ç»éªŒ |
|----|--------|--------|------|------|------|-------------|----------|
| 1  | 120    | 95     | 15   | 8    | 52   | 100         | 0        |
| 2  | 140    | 110    | 20   | 11   | 54   | 283         | 100      |
| 3  | 160    | 125    | 25   | 14   | 56   | 520         | 383      |
| 4  | 180    | 140    | 30   | 17   | 58   | 800         | 903      |
| 5  | 200    | 155    | 35   | 20   | 60   | 1118        | 1703     |
| 6  | 220    | 170    | 40   | 23   | 62   | 1470        | 2821     |
| 7  | 240    | 185    | 45   | 26   | 64   | 1852        | 4291     |
| 8  | 260    | 200    | 50   | 29   | 66   | 2263        | 6143     |
| 9  | 280    | 215    | 55   | 32   | 68   | 2700        | 8406     |
| 10 | 300    | 230    | 60   | 35   | 70   | -(çªç ´)     | 11106    |

### 2.2 å„å¢ƒç•Œå…³é”®å±æ€§é¢„è§ˆ

| å¢ƒç•Œ | ç­‰çº§ | ç³»æ•° | Lvèµ·å§‹HP | Lvç»ˆHP | Lvèµ·å§‹æ”»å‡» | Lvç»ˆæ”»å‡» |
|------|------|------|----------|--------|-----------|----------|
| æµ·æ´‹çº§ | 1-10  | 1.0   | 120    | 300    | 15    | 60     |
| é™†åœ°çº§ | 11-20 | 2.0   | 620    | 1000   | 110   | 200    |
| è’èŠœçº§ | 21-30 | 4.0   | 2080   | 3600   | 410   | 720    |
| è¡Œæ˜Ÿçº§ | 31-40 | 8.0   | 7360   | 13600  | 1520  | 2880   |
| æ’æ˜Ÿçº§ | 41-50 | 16.0  | 27520  | 52000  | 5840  | 11200  |
| é“¶æ²³çº§ | 51-60 | 32.0  | 105,280 | 200,000 | 22,880 | 44,160 |

### 2.3 å±æ€§è®¡ç®—å…¬å¼æ±‡æ€»

```typescript
// lib/game/player-stats.ts

/** å¢ƒç•Œç³»æ•°è¡¨ */
const REALM_COEFFICIENTS: Record<string, number> = {
  ocean: 1.0,    // æµ·æ´‹çº§
  land: 2.0,     // é™†åœ°çº§
  barren: 4.0,   // è’èŠœçº§
  planet: 8.0,   // è¡Œæ˜Ÿçº§
  star: 16.0,    // æ’æ˜Ÿçº§
  galaxy: 32.0,  // é“¶æ²³çº§
  beyond: 64.0,  // è¶…è¶Šçº§
  ancient: 128.0,// æ´ªè’çº§
  void: 256.0,   // ç©ºçµçº§
  origin: 512.0, // å…ƒåˆçº§
};

interface StatCalculationResult {
  maxHp: number;
  maxMp: number;
  attack: number;
  defense: number;
  speed: number;
}

/**
 * è®¡ç®—ç©å®¶æœ€ç»ˆå±æ€§
 * æœ€ç»ˆå±æ€§ = åŸºç¡€å±æ€§ Ã— å¢ƒç•Œç³»æ•° + è£…å¤‡åŠ æˆ + å›¾é‰´åŠ æˆ + ä¸´æ—¶buff
 */
function calculatePlayerStats(
  level: number,
  realm: string,
  equipmentBonus: StatBonus,
  collectionBonus: StatBonus,
  buffBonus: StatBonus
): StatCalculationResult {
  const coeff = REALM_COEFFICIENTS[realm] ?? 1.0;

  return {
    maxHp: Math.floor((100 + level * 20) * coeff) + equipmentBonus.hp + collectionBonus.hp + buffBonus.hp,
    maxMp: Math.floor((80 + level * 15) * coeff) + equipmentBonus.mp + collectionBonus.mp + buffBonus.mp,
    attack: Math.floor((10 + level * 5) * coeff) + equipmentBonus.attack + collectionBonus.attack + buffBonus.attack,
    defense: Math.floor((5 + level * 3) * coeff) + equipmentBonus.defense + collectionBonus.defense + buffBonus.defense,
    speed: 50 + level * 2 + equipmentBonus.speed + collectionBonus.speed + buffBonus.speed,
  };
}

/**
 * å‡çº§æ‰€éœ€ç»éªŒ
 * å…¬å¼: 100 Ã— (level ^ 1.5)
 */
function expToNextLevel(level: number): number {
  return Math.floor(100 * Math.pow(level, 1.5));
}

/**
 * æˆ˜æ–—ç»éªŒè·å–
 * å…¬å¼: æ•ŒäººåŸºç¡€ç»éªŒ Ã— (1 + éš¾åº¦ç³»æ•°) Ã— ç»éªŒåŠ æˆ
 * ç­‰çº§å·®æƒ©ç½š: æ•Œäººç­‰çº§æ¯”ç©å®¶ä½5çº§ä»¥ä¸Šï¼Œç»éªŒå‡åŠ
 */
function calculateBattleExp(
  enemyBaseExp: number,
  difficultyModifier: number,
  expBonus: number,
  playerLevel: number,
  enemyLevel: number
): number {
  let exp = enemyBaseExp * (1 + difficultyModifier) * (1 + expBonus);
  
  // ç­‰çº§å·®æƒ©ç½š
  const levelDiff = playerLevel - enemyLevel;
  if (levelDiff >= 10) exp *= 0.1;       // 10çº§ä»¥ä¸Šå·®è·ï¼šä»…10%ç»éªŒ
  else if (levelDiff >= 7) exp *= 0.3;   // 7-9çº§å·®è·ï¼š30%
  else if (levelDiff >= 5) exp *= 0.5;   // 5-6çº§å·®è·ï¼š50%
  else if (levelDiff >= 3) exp *= 0.8;   // 3-4çº§å·®è·ï¼š80%
  // ä½äºç©å®¶3çº§å†…æˆ–é«˜äºç©å®¶ï¼š100%

  // æ•Œäººé«˜äºç©å®¶æ—¶æœ‰é¢å¤–å¥–åŠ±
  if (enemyLevel > playerLevel) {
    exp *= 1 + (enemyLevel - playerLevel) * 0.1; // æ¯é«˜1çº§+10%
  }

  return Math.floor(exp);
}
```

---

## ä¸‰ã€æ•Œäººæ•°å€¼æ¨¡å‹

### 3.1 æ•ŒäººåŸºç¡€å±æ€§å…¬å¼

```typescript
// lib/game/enemy-stats.ts

/** æ•Œäººç±»å‹ä¿®æ­£ */
const ENEMY_TYPE_MODIFIERS = {
  normal:  { hp: 1.0, attack: 1.0, defense: 1.0, exp: 1.0, gold: 1.0 },
  elite:   { hp: 2.5, attack: 1.5, defense: 1.3, exp: 3.0, gold: 3.0 },
  boss:    { hp: 5.0, attack: 2.0, defense: 1.5, exp: 8.0, gold: 8.0 },
  miniboss:{ hp: 3.5, attack: 1.8, defense: 1.4, exp: 5.0, gold: 5.0 },
};

/**
 * æ ¹æ®ç­‰çº§ç”Ÿæˆæ•ŒäººåŸºç¡€å±æ€§
 * è®¾è®¡åŸåˆ™ï¼šåŒç­‰çº§æ•Œäººçº¦ä¸ºç©å®¶å±æ€§çš„60-80%
 * å¤šæ•Œäººæ—¶æ€»é‡æ¥è¿‘100-130%
 */
function generateEnemyStats(
  level: number,
  realm: string,
  type: 'normal' | 'elite' | 'boss' | 'miniboss'
): EnemyBaseStats {
  const coeff = REALM_COEFFICIENTS[realm] ?? 1.0;
  const mod = ENEMY_TYPE_MODIFIERS[type];

  // åŸºç¡€å€¼ä¸ºç©å®¶å±æ€§çš„çº¦70%
  const baseHp = Math.floor((100 + level * 20) * coeff * 0.7 * mod.hp);
  const baseAttack = Math.floor((10 + level * 5) * coeff * 0.65 * mod.attack);
  const baseDefense = Math.floor((5 + level * 3) * coeff * 0.6 * mod.defense);
  const baseSpeed = Math.floor((50 + level * 2) * 0.9); // é€Ÿåº¦ç•¥ä½äºç©å®¶

  // ç»éªŒå’Œé‡‘å¸å¥–åŠ±
  const baseExp = Math.floor(30 + level * 8 * mod.exp);
  const baseGold = Math.floor(15 + level * 5 * mod.gold);

  return { hp: baseHp, attack: baseAttack, defense: baseDefense, 
           speed: baseSpeed, exp: baseExp, gold: baseGold };
}
```

### 3.2 æ•Œäººé…ç½®è¡¨ï¼ˆæµ·æ´‹çº§ç¤ºä¾‹ï¼‰

| æ•Œäººåç§° | ç­‰çº§ | ç±»å‹ | HP | æ”»å‡» | é˜²å¾¡ | é€Ÿåº¦ | å±æ€§ | ç»éªŒ | é‡‘å¸ |
|----------|------|------|-----|------|------|------|------|------|------|
| å°çŠç‘šèŸ¹ | 1 | normal | 84 | 10 | 5 | 47 | water | 38 | 20 |
| æµ·è—»æ€ª | 2 | normal | 98 | 13 | 7 | 49 | water | 46 | 25 |
| æ¯’æ°´æ¯ | 3 | normal | 112 | 16 | 8 | 51 | water | 54 | 30 |
| çŠç‘šèŸ¹ | 4 | normal | 126 | 20 | 10 | 53 | water | 62 | 35 |
| æ·±æµ·èŸ¹æ€ª | 5 | normal | 140 | 23 | 12 | 55 | water | 70 | 40 |
| æµ·è›‡ | 5 | normal | 140 | 26 | 10 | 58 | water | 70 | 40 |
| å¹½çµæ°´æ‰‹ | 6 | normal | 154 | 26 | 14 | 57 | dark | 78 | 45 |
| æµ·å¦–å°å…µ | 7 | normal | 168 | 29 | 15 | 59 | water | 86 | 50 |
| æµ·å¦–æ–¥å€™ | 8 | elite | 420 | 49 | 23 | 61 | water | 192 | 120 |
| æ·±æµ·èŸ¹å°† | 8 | miniboss | 490 | 54 | 25 | 58 | water | 320 | 200 |
| æµ·å¦–å¥³ç‹ | 10 | boss | 1050 | 78 | 32 | 65 | water | 640 | 400 |

### 3.3 æˆ˜æ–—æ—¶é•¿é¢„æœŸ

| æˆ˜æ–—ç±»å‹ | é¢„æœŸå›åˆæ•° | é¢„æœŸæ—¶é—´(å«é˜…è¯») |
|----------|-----------|-----------------|
| æ™®é€šæˆ˜æ–—(1v1) | 4-6å›åˆ | 2-3åˆ†é’Ÿ |
| æ™®é€šæˆ˜æ–—(1v2) | 5-8å›åˆ | 3-4åˆ†é’Ÿ |
| ç²¾è‹±æˆ˜æ–— | 8-12å›åˆ | 4-6åˆ†é’Ÿ |
| BOSSæˆ˜ | 12-20å›åˆ | 6-10åˆ†é’Ÿ |
| è¯•ç‚¼å¡”å•å±‚ | 3-5å›åˆ | 1-2åˆ†é’Ÿ |

---

## å››ã€ä¼¤å®³æ¨¡å‹æ·±åº¦åˆ†æ

### 4.1 å®Œæ•´ä¼¤å®³è®¡ç®—é“¾

```typescript
// lib/game/damage-calculator.ts

interface DamageCalcInput {
  attacker: {
    attack: number;
    critRate: number;
    critDamage: number;
    element: string;
    level: number;
    statusEffects: StatusEffect[];
  };
  defender: {
    defense: number;
    element: string;
    level: number;
    statusEffects: StatusEffect[];
    isDefending: boolean;
  };
  skill: {
    damageRatio: number;
    element: string;
    ignoreDefensePercent?: number; // æš—å½±ç®­ç­‰æ— è§†é˜²å¾¡
  };
  environment: {
    weather: string;
    timeOfDay: string;
    season: string;
  };
}

interface DamageCalcResult {
  finalDamage: number;
  isCrit: boolean;
  elementBonus: number;    // å±æ€§å…‹åˆ¶å€ç‡
  environmentBonus: number; // ç¯å¢ƒåŠ æˆå€ç‡
  breakdown: {
    baseDamage: number;
    afterDefense: number;
    afterCrit: number;
    afterElement: number;
    afterEnvironment: number;
    afterRandom: number;
  };
}

function calculateDamage(input: DamageCalcInput): DamageCalcResult {
  const { attacker, defender, skill, environment } = input;

  // ===== Step 1: åŸºç¡€ä¼¤å®³ =====
  const baseDamage = attacker.attack * skill.damageRatio;

  // ===== Step 2: é˜²å¾¡å‡ä¼¤ =====
  // å…¬å¼: å‡ä¼¤ç‡ = é˜²å¾¡ / (é˜²å¾¡ + 100)
  // Lv1 é˜²å¾¡8: å‡ä¼¤7.4%  |  Lv10 é˜²å¾¡35: å‡ä¼¤25.9%
  // Lv50 é˜²å¾¡560: å‡ä¼¤84.8% (é«˜å¢ƒç•Œéœ€è¦ç©¿é€/æ— è§†é˜²å¾¡)
  let effectiveDefense = defender.defense;
  
  // æ— è§†é˜²å¾¡
  if (skill.ignoreDefensePercent) {
    effectiveDefense = Math.floor(effectiveDefense * (1 - skill.ignoreDefensePercent));
  }
  
  // é˜²å¾¡å§¿æ€åŠ æˆ
  if (defender.isDefending) {
    effectiveDefense = Math.floor(effectiveDefense * 1.5); // é˜²å¾¡çŠ¶æ€é˜²å¾¡+50%
  }

  const defenseReduction = effectiveDefense / (effectiveDefense + 100);
  const afterDefense = baseDamage * (1 - defenseReduction);

  // ===== Step 3: æš´å‡»åˆ¤å®š =====
  const isCrit = Math.random() < attacker.critRate;
  const afterCrit = isCrit ? afterDefense * attacker.critDamage : afterDefense;

  // ===== Step 4: å±æ€§å…‹åˆ¶ =====
  const elementBonus = getElementMultiplier(skill.element, defender.element);
  const afterElement = afterCrit * elementBonus;

  // ===== Step 5: ç¯å¢ƒåŠ æˆ =====
  const environmentBonus = getEnvironmentDamageBonus(skill.element, environment);
  const afterEnvironment = afterElement * environmentBonus;

  // ===== Step 6: çŠ¶æ€æ•ˆæœå½±å“ =====
  let statusMultiplier = 1.0;
  // æ”»å‡»æ–¹å¢ä¼¤buff
  for (const effect of attacker.statusEffects) {
    if (effect.type === 'attack_up') statusMultiplier *= (1 + effect.value / 100);
  }
  // é˜²å¾¡æ–¹å‡ä¼¤/å¢ä¼¤debuff
  for (const effect of defender.statusEffects) {
    if (effect.type === 'defense_down') statusMultiplier *= (1 + effect.value / 100);
  }
  const afterStatus = afterEnvironment * statusMultiplier;

  // ===== Step 7: éšæœºæµ®åŠ¨ Â±10% =====
  const randomFactor = 0.9 + Math.random() * 0.2;
  const afterRandom = afterStatus * randomFactor;

  // ===== æœ€ç»ˆä¼¤å®³ï¼ˆæœ€ä½1ï¼‰ =====
  const finalDamage = Math.max(1, Math.floor(afterRandom));

  return {
    finalDamage,
    isCrit,
    elementBonus,
    environmentBonus,
    breakdown: {
      baseDamage: Math.floor(baseDamage),
      afterDefense: Math.floor(afterDefense),
      afterCrit: Math.floor(afterCrit),
      afterElement: Math.floor(afterElement),
      afterEnvironment: Math.floor(afterEnvironment),
      afterRandom: finalDamage,
    },
  };
}
```

### 4.2 å±æ€§å…‹åˆ¶è¡¨

```typescript
/**
 * å±æ€§å…‹åˆ¶å…³ç³»
 * æ°´å…‹ç«ã€ç«å…‹æœ¨(é£)ã€æœ¨å…‹åœŸã€åœŸå…‹æ°´
 * æš— â†” å…‰ äº’ç›¸å…‹åˆ¶
 */
const ELEMENT_CHART: Record<string, Record<string, number>> = {
  water: { fire: 1.3, earth: 0.7, water: 1.0, wind: 1.0, dark: 1.0, light: 1.0, none: 1.0 },
  fire:  { wind: 1.3, water: 0.7, fire: 1.0, earth: 1.0, dark: 1.0, light: 1.0, none: 1.0 },
  wind:  { earth: 1.3, fire: 0.7, wind: 1.0, water: 1.0, dark: 1.0, light: 1.0, none: 1.0 },
  earth: { water: 1.3, wind: 0.7, earth: 1.0, fire: 1.0, dark: 1.0, light: 1.0, none: 1.0 },
  dark:  { light: 1.3, dark: 1.0, water: 1.0, fire: 1.0, wind: 1.0, earth: 1.0, none: 1.0 },
  light: { dark: 1.3, light: 1.0, water: 1.0, fire: 1.0, wind: 1.0, earth: 1.0, none: 1.0 },
  none:  { water: 1.0, fire: 1.0, wind: 1.0, earth: 1.0, dark: 1.0, light: 1.0, none: 1.0 },
};

function getElementMultiplier(attackElement: string, defenseElement: string): number {
  return ELEMENT_CHART[attackElement]?.[defenseElement] ?? 1.0;
}
```

### 4.3 ä¼¤å®³éªŒè¯ï¼ˆLv.5 ç©å®¶ vs Lv.5 æ•Œäºº æ¨¡æ‹Ÿï¼‰

```
ç©å®¶: Lv.5 æµ·æ´‹çº§, æ”»å‡»35, æš´å‡»ç‡5%, æš´å‡»ä¼¤å®³1.5x
æ•Œäºº: æ·±æµ·èŸ¹æ€ª, Lv.5, HP140, é˜²å¾¡12

=== æ™®é€šæ”»å‡» (å€ç‡1.0) ===
åŸºç¡€ä¼¤å®³: 35 Ã— 1.0 = 35
é˜²å¾¡å‡ä¼¤: 12/(12+100) = 10.7% â†’ 35 Ã— 0.893 = 31.3
éæš´å‡»: ~31 (Â±10% = 28~34)
æš´å‡»: 31 Ã— 1.5 = ~47

â†’ éœ€è¦ 4-5 æ¬¡æ™®æ”»å‡»æ€ (140/31 â‰ˆ 4.5)
â†’ åˆç†ï¼šçº¯æ™®æ”»çº¦5å›åˆç»“æŸ

=== å†°ç®­æœ¯ (å€ç‡1.3, æ°´ç³») ===
åŸºç¡€ä¼¤å®³: 35 Ã— 1.3 = 45.5
é˜²å¾¡å‡ä¼¤: â†’ 45.5 Ã— 0.893 = 40.6
å±æ€§å…‹åˆ¶(æ°´vsæ°´): 1.0 â†’ 40.6
éæš´å‡»: ~41 (Â±10% = 37~45)

â†’ éœ€è¦ 3-4 æ¬¡æŠ€èƒ½å‡»æ€
â†’ æŠ€èƒ½æ¯”æ™®æ”»å¼ºçº¦30%ï¼Œç¬¦åˆé¢„æœŸ

=== æš—å½±ç®­ (å€ç‡1.8, æš—ç³», æ— è§†30%é˜²å¾¡) ===
æœ‰æ•ˆé˜²å¾¡: 12 Ã— 0.7 = 8.4
åŸºç¡€ä¼¤å®³: 35 Ã— 1.8 = 63
é˜²å¾¡å‡ä¼¤: 8.4/(8.4+100) = 7.8% â†’ 63 Ã— 0.922 = 58.1
éæš´å‡»: ~58 (Â±10% = 52~64)

â†’ éœ€è¦ 2-3 æ¬¡å‡»æ€
â†’ é«˜å€ç‡+ç©¿ç”²æ•ˆæœæ˜æ˜¾ï¼Œä½†MPæ¶ˆè€—é«˜(35)ï¼Œä¸å¯æ»¥ç”¨
```

---

## äº”ã€ç»æµç³»ç»Ÿå¹³è¡¡

### 5.1 å•åœºæˆ˜æ–—æ”¶ç›Šé¢„æœŸ

| ç­‰çº§æ®µ | æˆ˜æ–—ç±»å‹ | ç»éªŒ | é‡‘å¸ | è£…å¤‡æ‰è½ç‡ |
|--------|----------|------|------|-----------|
| Lv.1-5 | æ™®é€š | 38-70 | 20-40 | 15% (ç™½/ç»¿) |
| Lv.1-5 | ç²¾è‹± | 192 | 120 | 40% (ç»¿/è“) |
| Lv.1-5 | BOSS | 640 | 400 | 80% (è“/ç´«) |
| Lv.6-10 | æ™®é€š | 78-110 | 45-60 | 15% |
| Lv.6-10 | ç²¾è‹± | 250 | 150 | 45% |
| Lv.6-10 | BOSS | 800 | 500 | 85% |

### 5.2 å‡çº§èŠ‚å¥è®¾è®¡

```
è®¾è®¡ç›®æ ‡: æ¯ä¸ªç­‰çº§éœ€è¦ 8-12 åœºæ™®é€šæˆ˜æ–— å‡çº§
         æˆ– 3-5 åœºåŒ…å«ç²¾è‹±/BOSSçš„æ··åˆæˆ˜æ–—

ç¤ºä¾‹: Lv.5 â†’ Lv.6 éœ€è¦ 1118 ç»éªŒ
  - çº¯æ™®é€šæˆ˜æ–—(~70exp): 1118/70 = ~16åœº (åå¤šï¼Œé¼“åŠ±åšä»»åŠ¡)
  - ä»»åŠ¡+æˆ˜æ–—: ä»»åŠ¡å¥–åŠ±~300exp + 8åœºæˆ˜æ–—(~560exp) = ~860 â‰ˆ åˆç†
  - åŒ…å«ç²¾è‹±: ä»»åŠ¡300 + 5åœºæ™®é€š350 + 2åœºç²¾è‹±384 = 1034 â‰ˆ åˆç†

é¢„æœŸæ¯çº§æ¸¸æˆæ—¶é—´: 20-30åˆ†é’Ÿ
é¢„æœŸæµ·æ´‹çº§(1-10)æ€»æ—¶é—´: 3-5å°æ—¶
```

### 5.3 é‡‘å¸äº§å‡ºä¸æ¶ˆè€—å¹³è¡¡

```typescript
// æµ·æ´‹çº§ç»æµå¹³è¡¡é¢„è§ˆ

/** äº§å‡º (æ¯çº§å¹³å‡) */
const INCOME_PER_LEVEL = {
  battleGold: 400,      // ~10åœºæˆ˜æ–— Ã— ~40é‡‘å¸
  questGold: 200,       // ä»»åŠ¡å¥–åŠ±
  sellItems: 100,       // å‡ºå”®å¤šä½™æ‰è½
  adventureGold: 50,    // å¥‡é‡äº‹ä»¶
  // æ€»è®¡: ~750/çº§
};

/** æ¶ˆè€— (æ¯çº§å¹³å‡) */
const EXPENSES_PER_LEVEL = {
  potions: 150,         // å›å¤è¯å‰‚ (~5ç“¶ Ã— 30é‡‘å¸)
  equipEnhance: 200,    // è£…å¤‡å¼ºåŒ– (æ¯2çº§å¼ºåŒ–ä¸€æ¬¡)
  shopPurchase: 100,    // å•†åº—è´­ä¹°æ‚é¡¹
  adventureCost: 50,    // å¥‡é‡äº‹ä»¶æ¶ˆè€—
  // æ€»è®¡: ~500/çº§
};

// å‡€ä½™: ~250/çº§ï¼Œè¶³å¤Ÿç§¯ç´¯ä½†ä¸ä¼šè¿‡å‰©
// å¢ƒç•Œçªç ´æ¶ˆè€—: ~2000çµçŸ³ (éœ€è¦çº¦10çº§ç§¯ç´¯çš„å‰¯æœ¬çµçŸ³)
```

### 5.4 æ‰è½æ¦‚ç‡è¡¨

```typescript
// lib/game/loot-table.ts

interface LootEntry {
  itemId: string;
  dropRate: number;     // 0.0 ~ 1.0
  minQuantity: number;
  maxQuantity: number;
  qualityWeights?: Record<string, number>; // å“è´¨æƒé‡
}

/** å“è´¨æƒé‡ï¼ˆæ ¹æ®æ•Œäººç±»å‹ï¼‰ */
const QUALITY_WEIGHTS = {
  normal: { common: 60, uncommon: 30, rare: 8, epic: 2, legendary: 0, mythic: 0 },
  elite:  { common: 20, uncommon: 40, rare: 30, epic: 8, legendary: 2, mythic: 0 },
  boss:   { common: 5, uncommon: 15, rare: 40, epic: 30, legendary: 8, mythic: 2 },
};

/**
 * æ‰§è¡Œæ‰è½åˆ¤å®š
 */
function rollLoot(
  lootTable: LootEntry[],
  enemyType: string,
  playerLuck: number
): LootResult[] {
  const results: LootResult[] = [];

  for (const entry of lootTable) {
    // å¹¸è¿å€¼å½±å“æ‰è½ç‡: æ¯10ç‚¹å¹¸è¿+1%
    const adjustedRate = Math.min(entry.dropRate * (1 + playerLuck * 0.001), 1.0);

    if (Math.random() < adjustedRate) {
      const quantity = randomInt(entry.minQuantity, entry.maxQuantity);
      const quality = rollQuality(QUALITY_WEIGHTS[enemyType] ?? QUALITY_WEIGHTS.normal, playerLuck);

      results.push({
        itemId: entry.itemId,
        quantity,
        quality,
      });
    }
  }

  return results;
}

function rollQuality(weights: Record<string, number>, luck: number): string {
  // å¹¸è¿å€¼æå‡ç¨€æœ‰å“è´¨æ¦‚ç‡
  const adjusted = { ...weights };
  adjusted.rare = (adjusted.rare ?? 0) * (1 + luck * 0.002);
  adjusted.epic = (adjusted.epic ?? 0) * (1 + luck * 0.003);
  adjusted.legendary = (adjusted.legendary ?? 0) * (1 + luck * 0.005);

  const total = Object.values(adjusted).reduce((sum, w) => sum + w, 0);
  let roll = Math.random() * total;

  for (const [quality, weight] of Object.entries(adjusted)) {
    roll -= weight;
    if (roll <= 0) return quality;
  }
  return 'common';
}
```

---

## å…­ã€å¢ƒç•Œçªç ´å¹³è¡¡

### 6.1 çªç ´æ¡ä»¶æ€»è¡¨

| çªç ´ | ç­‰çº§è¦æ±‚ | çªç ´ä¸¹ | çµçŸ³æ¶ˆè€— | å½“å‰å¢ƒç•Œæˆ˜æ–—æ¬¡æ•° | å¤‡æ³¨ |
|------|----------|--------|----------|-----------------|------|
| æµ·æ´‹â†’é™†åœ° | Lv.10 | é™†åœ°çªç ´ä¸¹Ã—1 | 500 | â‰¥30 | å¯é€šè¿‡ä»»åŠ¡è·å¾—çªç ´ä¸¹ |
| é™†åœ°â†’è’èŠœ | Lv.20 | è’èŠœçªç ´ä¸¹Ã—1 | 2000 | â‰¥60 | éœ€æ¢ç´¢ç‰¹å®šåŒºåŸŸ |
| è’èŠœâ†’è¡Œæ˜Ÿ | Lv.30 | è¡Œæ˜Ÿçªç ´ä¸¹Ã—1 | 8000 | â‰¥100 | éœ€å‡»è´¥ç‰¹å®šBOSS |
| è¡Œæ˜Ÿâ†’æ’æ˜Ÿ | Lv.40 | æ’æ˜Ÿçªç ´ä¸¹Ã—1 | 30000 | â‰¥150 | éœ€å®Œæˆæ˜Ÿé™…è¯•ç‚¼ |
| æ’æ˜Ÿâ†’é“¶æ²³ | Lv.50 | é“¶æ²³çªç ´ä¸¹Ã—1 | 100000 | â‰¥200 | éœ€è§‰é†’ç‰¹æ®Šèƒ½åŠ› |

### 6.2 çªç ´æ—¶å±æ€§è·³è·ƒ

```typescript
/**
 * å¢ƒç•Œçªç ´æ—¶çš„å±æ€§é‡ç®—
 * çªç ´åå±æ€§ä¼šæœ‰æ˜¾è‘—è·³è·ƒï¼Œç»™ç©å®¶å¼ºçƒˆçš„æˆé•¿æ„Ÿ
 */
function onRealmBreakthrough(player: Player, newRealm: string): void {
  const oldCoeff = REALM_COEFFICIENTS[player.realm];
  const newCoeff = REALM_COEFFICIENTS[newRealm];
  
  // é‡æ–°è®¡ç®—æ‰€æœ‰å±æ€§
  const newStats = calculatePlayerStats(
    player.level, newRealm,
    getEquipmentBonus(player),
    getCollectionBonus(player),
    getBuffBonus(player)
  );

  // ç¤ºä¾‹: æµ·æ´‹Lv.10(ç³»æ•°1.0) â†’ é™†åœ°Lv.11(ç³»æ•°2.0)
  // HP: 300 â†’ 620 (+106%)
  // æ”»å‡»: 60 â†’ 110 (+83%)
  // è¿™ç§ç¿»å€å¼çš„æˆé•¿æå¤§å¢å¼ºæˆå°±æ„Ÿ

  player.realm = newRealm;
  player.maxHp = newStats.maxHp;
  player.maxMp = newStats.maxMp;
  player.attack = newStats.attack;
  player.defense = newStats.defense;
  player.speed = newStats.speed;
  
  // çªç ´åæ»¡è¡€æ»¡è“
  player.currentHp = player.maxHp;
  player.currentMp = player.maxMp;
}
```

---

## ä¸ƒã€éš¾åº¦ç­‰çº§ç³»ç»Ÿ

### 7.1 å››ä¸ªéš¾åº¦ç­‰çº§

| éš¾åº¦ | æ•Œäººå±æ€§å€ç‡ | å¥–åŠ±å€ç‡ | é€‚åˆåœºæ™¯ |
|------|-------------|----------|----------|
| ç®€å• (Easy) | 0.8x | 0.7x | æ–°æ‰‹/ä¼‘é—²/æŒ‚æœº |
| æ™®é€š (Normal) | 1.0x | 1.0x | é»˜è®¤éš¾åº¦ |
| å›°éš¾ (Hard) | 1.3x | 1.5x | æŒ‘æˆ˜/åˆ·è£…å¤‡ |
| å™©æ¢¦ (Nightmare) | 1.6x | 2.0x | æé™æŒ‘æˆ˜ |

### 7.2 æˆ˜æ–—è¯„åˆ†ç³»ç»Ÿ

```typescript
/**
 * æˆ˜æ–—ç»“æŸåçš„è¡¨ç°è¯„åˆ†
 * å½±å“é¢å¤–å¥–åŠ±å’Œå›¾é‰´è¯„ä»·
 */
function calculateBattleScore(battleResult: BattleResult): BattleScore {
  let score = 0;

  // åŸºç¡€åˆ†: èƒœåˆ©100åˆ†, å¤±è´¥30åˆ†, é€ƒè·‘10åˆ†
  if (battleResult.result === 'victory') score += 100;
  else if (battleResult.result === 'defeat') score += 30;
  else score += 10;

  // å›åˆæ•ˆç‡: è¶Šå¿«è¶Šé«˜åˆ†
  // ç†æƒ³å›åˆæ•°çš„1.5å€ä»¥å†…ä¸ºA, 2å€ä»¥å†…ä¸ºB, è¶…è¿‡ä¸ºC
  const idealRounds = Math.ceil(battleResult.totalEnemyHp / battleResult.playerAttack / 0.7);
  const roundRatio = battleResult.rounds / idealRounds;
  if (roundRatio <= 1.0) score += 50;       // Sçº§æ•ˆç‡
  else if (roundRatio <= 1.5) score += 35;  // Açº§
  else if (roundRatio <= 2.0) score += 20;  // Bçº§
  else score += 10;                          // Cçº§

  // HPä¿æŒ: ç»“æŸæ—¶HPè¶Šé«˜è¶Šé«˜åˆ†
  const hpPercent = battleResult.playerHpPercent;
  if (hpPercent >= 0.8) score += 30;
  else if (hpPercent >= 0.5) score += 20;
  else if (hpPercent >= 0.2) score += 10;
  else score += 5;

  // é›¶ä¼¤å®³åŠ åˆ†
  if (battleResult.damageTaken === 0) score += 20;

  // è¯„çº§
  const grade = score >= 180 ? 'S' : score >= 150 ? 'A' : score >= 100 ? 'B' : 'C';

  // è¯„çº§å¯¹åº”çš„å¥–åŠ±å€ç‡
  const rewardMultiplier = { S: 1.5, A: 1.2, B: 1.0, C: 0.9 }[grade];

  return { score, grade, rewardMultiplier };
}
```

---

## å…«ã€ä¼šè¯èŠ‚å¥è®¾è®¡

### 8.1 ç†æƒ³çš„20åˆ†é’Ÿæ¸¸æˆä¼šè¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ç†æƒ³çš„20åˆ†é’Ÿæ¸¸æˆä¼šè¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  0-2åˆ†é’Ÿ: ç™»å½•ï¼ŒæŸ¥çœ‹çŠ¶æ€ï¼Œæ£€æŸ¥ä»»åŠ¡                           â”‚
â”‚           â””â†’ æ»¡è¶³æ„Ÿ: "æˆ‘çŸ¥é“ä»Šå¤©è¦åšä»€ä¹ˆ"                    â”‚
â”‚                                                            â”‚
â”‚  2-5åˆ†é’Ÿ: æ¥ä»»åŠ¡/é€‰æ‹©åŒºåŸŸæ¢ç´¢                                â”‚
â”‚           â””â†’ AIç”ŸæˆåŒºåŸŸèƒŒæ™¯ï¼ˆé¦–æ¬¡ï¼‰æˆ–ç›´æ¥è¿›å…¥                 â”‚
â”‚                                                            â”‚
â”‚  5-12åˆ†é’Ÿ: 2-3åœºæˆ˜æ–—                                        â”‚
â”‚           â””â†’ æ ¸å¿ƒæ¸¸æˆå¾ªç¯ï¼Œæˆ˜æ–—+å¥–åŠ±                        â”‚
â”‚           â””â†’ å¯èƒ½è§¦å‘å¥‡é‡äº‹ä»¶                               â”‚
â”‚                                                            â”‚
â”‚  12-16åˆ†é’Ÿ: äº¤ä»»åŠ¡/æ•´ç†è£…å¤‡                                  â”‚
â”‚           â””â†’ æ»¡è¶³æ„Ÿ: "æˆ‘å®Œæˆäº†ä¸€ä¸ªä»»åŠ¡/å‡äº†çº§"               â”‚
â”‚                                                            â”‚
â”‚  16-20åˆ†é’Ÿ: å†æ‰“1-2åœºæˆ–æ¢ç´¢                                  â”‚
â”‚           â””â†’ ä¸ºä¸‹æ¬¡ä¼šè¯ç•™ä¸‹"é’©å­"ï¼ˆæ–°ä»»åŠ¡/æ–°åŒºåŸŸæç¤ºï¼‰       â”‚
â”‚                                                            â”‚
â”‚  ä¼šè¯ç»“ç®—: ç»éªŒ+é‡‘å¸+å¯èƒ½çš„è£…å¤‡+ä»»åŠ¡è¿›åº¦                      â”‚
â”‚           â””â†’ æ»¡è¶³æ„Ÿ: "è¿™20åˆ†é’Ÿå¾ˆå€¼å¾—"                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

> ğŸ“ æœ¬æ–‡æ¡£å®šä¹‰äº† ChaosSaga çš„å®Œæ•´æ•°å€¼å¹³è¡¡ä½“ç³»ã€‚æ‰€æœ‰æ•°å€¼è®¡ç®—ç”±æ•°å­¦å…¬å¼é©±åŠ¨ï¼ŒåŒ…å«è¯¦ç»†çš„å±æ€§æ¨¡å‹ã€ä¼¤å®³è®¡ç®—ã€ç»æµç³»ç»Ÿå’Œä¼šè¯èŠ‚å¥è®¾è®¡ã€‚å…³é”®è®¾è®¡ç‚¹å·²é€šè¿‡æ•°å€¼éªŒè¯ï¼ˆLv.5æ¨¡æ‹Ÿæˆ˜æ–—ï¼‰ï¼Œç¡®ä¿æ¸¸æˆä½“éªŒåˆç†ã€‚
